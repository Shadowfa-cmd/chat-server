<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shadow Chat</title>
<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>

<!-- لینک manifest برای PWA -->
<link rel="manifest" href="/manifest.json">

<style>
    body {
        background-color: #111;
        color: #0f0;
        font-family: "Courier New", monospace;
        margin: 0;
        padding: 0;
    }
    header {
        background: #000;
        padding: 10px;
        font-size: 20px;
        text-align: center;
        border-bottom: 1px solid #0f0;
    }
    #login {
        display: flex;
        flex-direction: column;
        max-width: 300px;
        margin: 50px auto;
        background: #222;
        padding: 20px;
        border: 1px solid #0f0;
        border-radius: 10px;
    }
    #login input, #login button {
        margin: 10px 0;
        padding: 10px;
        background: #111;
        border: 1px solid #0f0;
        color: #0f0;
        border-radius: 5px;
    }
    #chat {
        display: none;
        max-width: 600px;
        margin: 20px auto;
    }
    #messages {
        list-style: none;
        padding: 0;
        height: 300px;
        overflow-y: scroll;
        border: 1px solid #0f0;
        padding: 10px;
        background: #000;
        border-radius: 10px;
    }
    #messages li {
        margin: 5px 0;
    }
    #messageInput {
        width: calc(100% - 100px);
        padding: 10px;
        background: #111;
        border: 1px solid #0f0;
        color: #0f0;
        border-radius: 5px;
    }
    #sendBtn {
        width: 80px;
        padding: 10px;
        margin-left: 10px;
        background: #0f0;
        color: #000;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
</style>
</head>
<body>
<header id="header">Shadow</header>

<div id="login">
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<div id="chat">
    <ul id="messages"></ul>
    <div style="display:flex; margin-top:10px;">
        <input id="messageInput" autocomplete="off">
        <button id="sendBtn" onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
const SOCKET_SERVER = '/';
const sio = io(SOCKET_SERVER);

// ثبت یک بار یوزرنیم
let savedUser = localStorage.getItem('chatUser');
if(savedUser){
    document.getElementById('login').style.display='none';
    document.getElementById('chat').style.display='block';
    document.getElementById('header').innerText = savedUser;
}

function login(){
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;

    if(user === "" || pass === ""){
        alert("Enter username and password");
        return;
    }

    // پسورد سخت‌کد شده Shadow
    if(pass !== "Shadow"){
        alert("Wrong password");
        return;
    }

    localStorage.setItem('chatUser', user);
    document.getElementById('login').style.display='none';
    document.getElementById('chat').style.display='block';
    document.getElementById('header').innerText = user;
}

sio.on('connect', () => {
    console.log('Connected');
});

sio.on('message', (msg) => {
    const li = document.createElement('li');
    li.textContent = msg;
    document.getElementById('messages').appendChild(li);
});

function sendMessage(){
    const input = document.getElementById('messageInput');
    const user = localStorage.getItem('chatUser') || 'Anonymous';
    const msg = `${user}: ${input.value}`;
    sio.send(msg);
    input.value = '';
}

// ثبت Service Worker برای PWA
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(() => {
        console.log('Service Worker registered.');
    });
}
</script>
</body>
</html>
